<%= render 'layouts/dataTable' %>

<% if params[:agroecological_practice_id] %>
  <% title t(:gallery) + " #{@agroecological_practice.local.nome}" %>
<% end %>

<% if usuario_signed_in? %>
  <% if params[:agroecological_practice_id] %>
    <%= link_to t(:send_photo), new_agroecological_practice_midia_path, :class => "btn btn-warning", :style => "float:right;" if current_usuario.admin? or @agroecological_practice.usuario_id == current_usuario.id %>
  <% elsif params[:local_id] %>
    <%= link_to t(:send_photo), new_local_midia_path, :class => "btn btn-warning", :style => "float:right;" if current_usuario.admin? or @local.usuario_id == current_usuario.id %>
  <% end %>
<% end %>

<br><br><br>

<ul class="nav nav-tabs">
  <% if params[:local_id] %>
      <li class="nav-item">
        <%= link_to truncate(@local.nome, length: 12), local_path(@local), :class => "nav-link" %>
      </li>
  <% end %>

  <li class="nav-item">
    <% if params[:agroecological_practice_id] %>
      <%= link_to truncate(@agroecological_practice.local.nome, length: 12), agroecological_practice_path(@agroecological_practice), :class => "nav-link" %>
    <% elsif params[:local_id] %>
      <%= link_to t(:gallery)+ " (#{@local.midias.count})", local_path(@local), :class => "nav-link active" %>
    <% end %>
  </li>

  <li class="nav-item">
    <% if params[:agroecological_practice_id] %>
      <%= link_to t(:gallery) + " (#{@agroecological_practice.midias.count})", agroecological_practice_gallery_path, :class => "nav-link active" %>
    <% end %>
  </li>
</ul>

<% if @midias.empty? %>
  <br>

  <h3><%= t(:no_photo_submitted) %>
    <% if usuario_signed_in? %>
      <% if params[:agroecological_practice_id] %>
        <%= link_to t(:send_picture), new_agroecological_practice_midia_path(@agroecological_practice) if current_usuario.admin? or @agroecological_practice.usuario_id == current_usuario.id %>
      <% end %>
    <% end %>
  </h3>

<% else %>

  <br>

  <div class="row justify-content-left" style="margin-left: 32px;">
    <div class="col-md-8">
      <div class="row">
        <% @midias.each do |midia| %>
          <div class="gallery-image">
            <a href="<%= midia.imagem.url(:original) %>>" data-toggle="lightbox" data-gallery="midia-gallery" class="col-sm-4" data-max-width="900">
              <img src="<%= midia.imagem.url(:medium) %>" alt="Photo <%= midia.descricao %>" title="Photo <%= midia.descricao %>" class="img-fluid">
            </a>
          </div>
          <% if usuario_signed_in? %>
            <% if @local or @agroecological_practice %>
              <% if current_usuario.admin? or current_usuario.id == (@local ? @local.usuario.id : nil) or current_usuario.id == (@agroecological_practice ? @agroecological_practice.usuario.id : nil)%>
                <div class="midia-control">
                  <% if @local %>
                    <%= link_to " &nbsp; Edit &nbsp; ".html_safe, edit_local_midia_path(@local, midia), :class => 'btn btn-success btn-sm', :style => 'font-size: 10px;'%>
                    <br>
                    <%= link_to t(:destroy), local_midia_path(@local, midia), :method => 'delete', :data => { :confirm => t('.confirm', :default => t("helpers.links.confirm", :default => 'Are you Sure?')) }, :class => 'btn btn-danger btn-sm', :style => 'font-size: 10px;' %>
                  <% end %>

                  <% if @agroecological_practice %>
                    <%= link_to " &nbsp; Edit &nbsp; ".html_safe, edit_agroecological_practice_midia_path(@agroecological_practice, midia), :class => 'btn btn-success btn-sm', :style => 'font-size: 10px;'%>
                    <br>
                    <%= link_to t(:destroy), agroecological_practice_midia_path(@agroecological_practice, midia), :method => 'delete', :data => { :confirm => t('.confirm', :default => t("helpers.links.confirm", :default => 'Are you Sure?')) }, :class => 'btn btn-danger btn-sm', :style => 'font-size: 10px;' %>
                  <% end %>
                </div>
              <% end %>
            <% end %>
          <% end %>

        <% end %>
      </div>
    </div>
  </div>
  <br><br>
  <script>
      $(document).on('click', '[data-toggle="lightbox"]', function(event) {
          event.preventDefault();
          $(this).ekkoLightbox();
      });
  </script>
<% end %>
